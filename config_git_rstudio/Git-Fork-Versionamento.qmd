---
title: "Como Contribuir com Projetos Usando o Git"
author: "Evaldo Martins da Silva"
format:
  html:
    toc: true
    toc-location: left
    number-sections: true
editor: visual
lang: pt
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = F)
```

## Introdução

### Procedimentos Iniciais para configura o git e github

-   Crie uma conta gratuita no GitHub https://github.com/

-   Download o git neste link https://git-scm.com/downloads

-   Instale o git e depois abra-o

### Configurando para a comunicação segura entre Github e RStudio

-   Instale o pacote usethis e carregue-o

```{r}
library(usethis)
```

O pacote "usethis" é uma ferramenta muito útil para trabalhar com o Github e versionamento de códigos no R. Aqui estão algumas das principais funções que você pode usar:

1.  **`create_from_github()`**: Cria um novo projeto R a partir de um repositório do Github.
2.  **`create_package()`**: Cria uma nova estrutura de pacotes R em um diretório.
3.  **`use_git()`**: Inicializa um repositório Git em um diretório R existente.
4.  **`use_github()`**: Configura o acesso ao Github para o repositório Git atual.
5.  **`use_readme_rmd()`**: Cria um novo arquivo README.Rmd no diretório atual.
6.  **`use_testthat()`**: Configura um pacote R com testes usando o pacote "testthat".
7.  **`use_data()`**: Cria um novo conjunto de dados em um pacote R.
8.  **`use_r()`** e **`use_cpp()`**: Cria novos arquivos R e C++.
9.  **`use_vignette()`**: Cria uma nova estrutura de vignette R.
10. **`pr_init()`**: Inicializa um pull request para colaboração com outros usuários.
11. **`pr_push()`**: Envia o pull request para o repositório principal.
12. **`pr_review()`**: Faz revisão do pull request.

-   Configure o Github para o RStudio do seu computador com o Git

    É preciso ter criado uma conta no github previamente antes de realizar esta etapa.

```{r}
use_git_config(user.name = "astuciasnor", # Seu nome
                          user.email = "astuciasnor@gmail.com") # Seu email
```

-   Criar um novo token ou regenerar o token (codigo de 40 dig será produzido)

```{r}
usethis::create_github_token() # Muda para o site do github para fazer login
```

-   Depois que fizer login, gere o token na própria página do github e o copie.

    -   Você deverá colocar esse número no arquivo .Renviron. O .Renviron é um arquivo de configuração do R que permite que você especifique variáveis de ambiente para que fiquem disponíveis para o R. Ele é muito usado para disponibilizar senhas, chaves de API, ... - coisas que são secretas - e por isso não é boa prática colocá-las no código.

-   Abra o o arquivo .Renviron

```{r}
usethis::edit_r_environ()
```

-   Crie uma nova linha na forma: GITHUB_PAT=SEU_TOKEN. Exemplo:

    GITHUB_PAT=ghp_Ko3mdlNJpBzQ7lvzKTvGFg91f6HpBQlablalba

    -   Após adicionar o token copiado do site, pule uma linha e salve o arquivo.

    -   Reinicie o RStudio: CTRL + SHIFT + F10

## Métodos de Criação ou Obtenção de repositórios

### Método 1 para obtenção de repositório: Clonar repositório do Github

Copiar a url do repositório da web e criar o projeto via Rstudio, conforme Figura abaixo:

![](images/image-1567524009.png)

### Método 2 - Criando um Repositório Novo no Github via RStuido

-   Cria o projeto do zero no computador, liga o git e carrega para o Github

    Aqui vamos criar um projeto com o nome Teste1. Uma nova pasta de projeto será feita com o mesmo nome do projeto

```{r}
  usethis::create_project(path = "D:/dados_evaldo/scripts_git/Teste1")
  # Vai abrir o Rstudio com uma nova janela. No console dessa nova janela, digite:
  usethis::use_git()    # Digite no console desse projeto para ligá-lo ao Git
  usethis::use_github() # Digite no console desse projeto para levá-lo ao Github
```

-   Carregando um projeto que já possuo no computador ao digitar no console desse projeto:

```{r}
usethis::use_git()    # Para conectar com o Git
usethis::use_github() # Para criar na minha página do Github
```

### Método 3 - Clonando repositório do RStudio e fazendo fork

Obter um repositório desta maneira é uma forma de poder contribui com um mantenedor. Mas para isso, é preciso trabalhar com ramificações do repositório. Afinal o que são essas ramificações ?

#### Ramificações num projeto

No GitHub, ***branch*** (ou "ramificação", em português) é uma cópia do código-fonte de um repositório em um determinado ponto no tempo. As branches permitem que você experimente novas ideias, faça alterações em seu código e experimente diferentes recursos sem afetar o código principal ou a versão estável do seu projeto.

Cada branch é uma linha do tempo separada que você pode manipular independentemente das outras. Isso significa que você pode fazer mudanças em uma branch sem afetar o código principal, permitindo que você trabalhe em várias funcionalidades ou correções de bugs ao mesmo tempo.

As branches também são úteis para colaboração em equipe, pois permitem que diferentes membros trabalhem em diferentes funcionalidades ao mesmo tempo sem interferir no trabalho um do outro. Por exemplo, um desenvolvedor pode criar uma branch para trabalhar em uma nova funcionalidade e outro desenvolvedor pode criar uma branch para corrigir um bug. Essas alterações podem ser mescladas (ou "merged", em inglês) de volta na branch principal do projeto quando estiverem prontas.

![](https://www.nobledesktop.com/image/gitresources/git-branches-merge.png){fig-align="center" width="438"}

Ao criar uma branch no GitHub, é importante dar a ela um nome descritivo e significativo, para que outros colaboradores possam entender facilmente o que está sendo feito em cada branch. Além disso, é uma boa prática mesclar frequentemente as alterações feitas em uma branch de volta na branch principal do projeto para evitar conflitos e manter um histórico de alterações limpo e organizado.

### Clonando Repositórios de terceiros para colaborar

Será utilizado um clone do respositorio, mas desta vez com fork . Isto significa que poderei fazer modificações e tentar contribuir com o mantenedor do repositório original. Vamos apenas trabalhar com poucas linhas de código possível e usar um fluo de trabalho (workflow) simples, trabalhando com o github na web para fazer a comunicação com o mantenedor.

-   Faça o clone a partir da página do github do mantenedor

-   Utilize os comandos abaixo pra fazer um clone de um mantenedor de tal modo que possa fazer modificações e solicitar as suas mudaças no código

```{r}
#| eval: false 
usethis::create_from_github(
  repo_spec = "https://github.com/Evaldo-Martins-STAT/laquipedados",
  destdir = "D:/dados_evaldo/scripts_git",
  fork = TRUE)
```

## Contribuindo mudanças a um Repositório de Terceiros

Se o projeto lhe agradou e você pensa em implementar melhorias, crie sua ramificação propria para o projeto antes de qualquer modificação !!

### Preparativos - Criando branch, modificando, comitando e enviando

Antes de começar qualquer colaboração, recomenda-se fazer commit de modificações APENAS em **branch**. Evite dor de cabeça de fazer commit na **main**. Se vc fizer qualquer modificação, não salve e tenha certeza de estar na sua branch. Vamos começar, sem medo, pois também sempre há a possibilidade de reverter o que vc salvou, cliando na engrenagem da aba Git --\> Engrenagem --\> Revert.

-   Criando a branch (ramificação)

Antes de qualquer modificação, CRIE uma BRANCH e dê um nome claro e simples do que está implementando para a sua branch:

```{r}
#| eval: false 
usethis::pr_init(branch = "Melhorando_readme")
```

Outros exemplos: `usethis::pr_init(branch = "criando_grafico_bonito.R")`

-   Faça as contribuições no arquivo já existente (como o Read.me) ou crie um novo arquivo

Faça as modificações no arquivo desejado, Recomendamos criar um Readme de Rmarkdown para poder gerar o READEME.md usando a função: `use_readme_rmd().` Apague antes o readme original se houver.

-   Faça commit na branch

Faça o commit ou mesmo commits (com mensagens que deixem clara as mudanças)

-   Faça o PULL via `pr_push()` e não via seta push da aba git :

NÃO faça pull para atualizar e sim o `pr_push()`.

```{r}
#| eval: false 
usethis::pr_push()
```

A página do github será aberta para completar o pull request. Nesta página faça o seguinte:

> Clicar em ***Create Pull Request***

![](images/image-1333084503.png){width="148" height="48"}

Nestes Pulls pode ser colocado um comentário. A página muda para Open.

![](images/image-55614868.png)

## Verificação do criador do repositório

Na tela do criador, aparece no botão **Pull Request** 1 a solicitação em que o criador deve clicar nesse botão para verificar o que fizeram. Ele verifica a implementação e pode fazer umarevisão e pode iniciar uma conversação e agradecer e aperta no botão comment.

Aqui fica a opção de ele mesclare finalizar a PR ou pedir novas melhorias dos colaboradores.

Porém se o mantenedor ou você mesmo decide modificar a sua contribuição, faça o seguinte:

-   No mesmo projeto e arquivo e na mesma branch faça as alterações
-   Na aba git, selecione o arquivo modificado para deixá-lo disponivel e faça o commit
-   Para enviar o novo commit, use o Git Push (Seta verde para cima na aba Git do Rstudio). Na preisa abrir outra PR
-   Finalmente, se você acha que terminou toda a sua contribuição e só precisa
-   Enquanto aguardar a mesclagem ao projeto principal, você já pode encerrar essa PR com o comando:

```{r}
#| eval: false 
usethis::pr_finish()
```

## Confirmando a mesclagem

Se o mantenedor ficou satisfeito, ele poderá mesclar caso não haja conlfitos, com o seguintes passos:

> Merge Pull Request ---\> Confirme Merge

O próprio mantendor pode encerrar a PR.

## Mais informações

para obter mais informações, acesse o excelente livro:

[Happy Git and GitHub for the useR](https://happygitwithr.com/index.html)
